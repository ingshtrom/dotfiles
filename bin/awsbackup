#!/usr/bin/env bash
#
# Runs the AWS CLI in a Docker container
#
# Grabbed from https://aws.amazon.com/blogs/developer/aws-cli-v2-docker-image/
#
# It automatically mounts your ~/.aws directory to `/root/.aws` 
# and the current directory into `/aws`
#
# USAGE:
#
#   $ aws
#   # => runs the `aws` command in the container without any arguments
#
#   $ aws --version
#   # => opens the specified directory in your editor

arguments="$@"

if [[ "$(env | grep AWS | wc -l)" == "0" ]]
then
  echo 'Please log into AWS first!'
  exit 1
fi

#eval $(aws-okta env $AWS_OKTA_PROFILE | sed "s/^/export /")
env_vars="-e $(env | grep AWS | cut -d'=' -f1 | sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/ -e /g')"
bash -c "docker run --rm -ti $env_vars -v ~/.aws:/root/.aws -v $(pwd):/aws amazon/aws-cli $arguments"

