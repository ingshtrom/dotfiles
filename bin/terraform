#!/usr/bin/env bash
# vi: ft=sh
#
# Runs the Hashicorp Terraform binary in a Docker container
#
# It automatically mounts your ~/.aws directory to `/root/.aws` 
# and the current directory into `/tfdata`
#

arguments="$@"

if [[ "$(env | grep AWS | wc -l)" == "0" ]]
then
  echo 'Please log into AWS first!'
  exit 1
fi

env_vars="-e $(env | grep AWS | cut -d'=' -f1 | sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/ -e /g')"
bash -c "docker run --rm -ti $env_vars -v ~/.aws:/root/.aws -v $(pwd):/aws amazon/aws-cli $arguments"
